# Google Apps Script Data Transfer Tool

## 概要 (Overview)

このGoogle Apps Scriptプロジェクトは、Googleスプレッドシート間でデータを転送、変換、および検証するための一連のツールを提供します。主な機能は以下の通りです。

- **データ転送**: ソースシートからデータを読み取り、定義済みのマッピングルールに基づいて整形し、ターゲットシートに書き込みます。
- **データクレンジング**: 空白行の削除、複数行にわたるデータの統合、メールアドレスがないエントリのフィルタリングなど、4段階のデータクレンジングプロセスを実行します。
- **設定の更新**: クレンジングされたデータをマスターリストとして、別のメール設定シートを安全に（バックアップを取りながら）更新します。
- **差分比較と検証**: 更新された設定シートと前回のバックアップを比較し、変更点（新規、更新、削除）をレポートします。また、重複するエントリや不正な形式のメールアドレスも検出します。

## ファイル構成 (File Structure)

プロジェクトは、機能ごとに複数のファイルに分割されています。

- `src/Code.js`: メインのワークフローを制御し、UIメニューをセットアップします。
- `src/config.js`: スプレッドシートIDやシート名など、すべての設定を管理します。
- `src/spreadsheetUtils.js`: スプレッドシートの読み書きや操作に関するユーティリティ関数を含みます。
- `src/dataTransformations.js`: 4段階のデータクレンジングと変換ロジックを扱います。
- `src/dataValidation.js`: 重複チェックやメールアドレスの形式検証などの検証ロジックを扱います。
- `src/businessLogic.js`: 設定の更新と比較、レポート作成など、コアなビジネスロジックを扱います。
- `src/utils.js`: 書式設定や列インデックス変換など、汎用的なヘルパー関数を含みます。
- `tests/tests.js`: プロジェクトの単体テストを管理します。

## セットアップと使用方法 (Setup and Usage)

### 1. 設定

1.  `src/config.js`ファイルを開きます。
2.  `SOURCE_SPREADSHEET_ID`, `TARGET_SPREADSHEET_ID` などの定数を、ご自身の環境に合わせて更新してください。
3.  マッピングシート（デフォルトでは `マッピング設定`）に、データソースの列とターゲットの列の対応関係を定義します。

### 2. UIメニューからの実行

スプレッドシートを開くと、「データ転送ツール」というカスタムメニューが表示されます。

- **データを転送**: `transferData`関数を実行し、4段階のデータクレンジングプロセスを開始します。
- **リストを作成**: `updateMailSettings_refactored`関数を実行し、クレンジングされたデータに基づいてメール設定シートを更新します。
- **リストを比較**: `compareAndUpdateResults_refactored`関数を実行し、現在の設定とバックアップを比較して差分レポートを生成します。
- **一括実行**: 上記の3つのプロセスを順番に実行します。
- **すべてのテストを実行**: `tests/tests.js`内の単体テストスイートを実行し、関数の動作を検証します。

### 3. テスト

開発者は、`すべてのテストを実行`メニュー項目をクリックすることで、いつでもテストスイートを実行できます。テストはモックデータを使用しており、実際のスプレッドシートデータには影響を与えません。

## 注意事項

- スクリプトを実行する前に、Googleアカウントで適切な権限（スプレッドシートへのアクセスなど）を許可する必要があります。
- 大量のデータを処理する場合、Google Apps Scriptの実行時間制限（通常6分）を超える可能性があります。その場合は、一度に処理するデータ量を減らすなどの対策を検討してください。
